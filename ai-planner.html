<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartGrade - AI –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É—Ä–æ–∫–æ–≤</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/docxtemplater@3.37.11/build/docxtemplater.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.4/pizzip.min.js"></script>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            --primary: #8b5cf6;
            --primary-glow: #a855f7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --card-bg: rgba(30, 41, 59, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            min-height: 100vh;
            color: var(--text);
            overflow-x: hidden;
        }

        /* Floating Gradients */
        .gradients-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            overflow: hidden;
        }

        .gradient-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.5;
            animation: float 20s ease-in-out infinite;
        }

        .gradient-orb:nth-child(1) {
            width: 600px;
            height: 600px;
            background: linear-gradient(135deg, #8b5cf6, #a855f7);
            top: -200px;
            left: -200px;
        }

        .gradient-orb:nth-child(2) {
            width: 500px;
            height: 500px;
            background: linear-gradient(135deg, #ec4899, #f43f5e);
            bottom: -150px;
            right: -150px;
            animation-delay: -5s;
        }

        .gradient-orb:nth-child(3) {
            width: 400px;
            height: 400px;
            background: linear-gradient(135deg, #06b6d4, #3b82f6);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -10s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(20px, 30px) scale(1.02); }
        }

        /* Glassmorphism */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow: var(--glass-shadow);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 32px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--primary), var(--primary-glow));
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: var(--text);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 32px 32px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 900px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Left Panel - Template */
        .panel {
            padding: 32px;
        }

        .panel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        /* Upload Zone */
        .upload-zone {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--glass-border);
            border-radius: 20px;
            padding: 48px 32px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            min-height: 200px;
        }

        .upload-zone:hover, .upload-zone.dragover {
            border-color: var(--primary);
            background: rgba(139, 92, 246, 0.1);
        }

        .upload-zone.has-file {
            border-style: solid;
            border-color: var(--success);
        }

        .upload-icon {
            width: 64px;
            height: 64px;
            background: var(--card-bg);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
        }

        .upload-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .upload-subtitle {
            color: var(--text-muted);
            font-size: 13px;
        }

        input[type="file"] {
            display: none;
        }

        /* Template Preview */
        .template-preview {
            margin-top: 24px;
        }

        .template-preview-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 12px;
        }

        .template-placeholder {
            padding: 16px;
            background: var(--card-bg);
            border-radius: 12px;
            font-family: monospace;
            font-size: 13px;
            line-height: 1.6;
            color: var(--primary);
        }

        .placeholder-tag {
            display: inline-block;
            padding: 4px 10px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 6px;
            margin: 4px;
        }

        /* Right Panel - Form */
        .form-section {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px 18px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 500px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* AI Processing Animation */
        .ai-processing {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px;
            text-align: center;
        }

        .ai-processing.active {
            display: flex;
        }

        .ai-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-glow));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            margin-bottom: 24px;
            animation: aiPulse 1.5s ease-in-out infinite;
        }

        @keyframes aiPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px 10px rgba(139, 92, 246, 0.2); }
        }

        .ai-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .ai-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 24px;
        }

        .ai-dots {
            display: flex;
            gap: 8px;
        }

        .ai-dot {
            width: 10px;
            height: 10px;
            background: var(--primary);
            border-radius: 50%;
            animation: aiDot 1.4s ease-in-out infinite;
        }

        .ai-dot:nth-child(2) { animation-delay: 0.2s; }
        .ai-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes aiDot {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Generate Button */
        .btn-generate {
            width: 100%;
            padding: 20px 32px;
            background: linear-gradient(135deg, var(--primary), var(--primary-glow));
            border: none;
            border-radius: 16px;
            color: white;
            font-size: 18px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 24px;
        }

        .btn-generate:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.4);
        }

        .btn-generate:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Success Modal */
        .success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .success-modal.active {
            display: flex;
        }

        .success-content {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 48px;
            max-width: 480px;
            width: 100%;
            text-align: center;
            animation: modalPop 0.4s ease-out;
        }

        @keyframes modalPop {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--success), #34d399);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin: 0 auto 24px;
        }

        .success-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .success-subtitle {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 32px;
        }

        .success-file {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 16px 24px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success);
            border-radius: 12px;
            margin-bottom: 24px;
        }

        .success-file-icon {
            font-size: 24px;
        }

        .success-file-name {
            font-weight: 500;
        }

        .success-buttons {
            display: flex;
            gap: 12px;
        }

        .btn-download {
            flex: 1;
            padding: 14px 24px;
            background: var(--success);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-download:hover {
            background: #059669;
        }

        .btn-close {
            flex: 1;
            padding: 14px 24px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-close:hover {
            background: var(--glass-border);
        }

        /* Placeholders info */
        .placeholders-info {
            margin-top: 24px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 16px;
        }

        .placeholders-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-muted);
        }

        .placeholder-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .placeholder-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .placeholder-item code {
            padding: 4px 8px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 6px;
            color: var(--primary);
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- Background -->
    <div class="gradients-bg">
        <div class="gradient-orb"></div>
        <div class="gradient-orb"></div>
        <div class="gradient-orb"></div>
    </div>

    <!-- Header -->
    <header class="header glass-card">
        <a href="teacher-dashboard.html" class="logo">
            <div class="logo-icon">üìù</div>
            <span class="logo-text">SmartGrade</span>
        </a>
        <a href="teacher-dashboard.html" class="back-link">
            ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–∞—à–±–æ—Ä–¥—É
        </a>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Left Panel - Template -->
        <div class="glass-card panel">
            <div class="panel-title">
                <span>üìÑ</span> –®–∞–±–ª–æ–Ω –¥–æ–∫—É–º–µ–Ω—Ç–∞
            </div>
            <p class="panel-subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ Word-—à–∞–±–ª–æ–Ω —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏</p>
            
            <div class="upload-zone" id="uploadZone">
                <div class="upload-icon">üìÅ</div>
                <div class="upload-title">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</div>
                <div class="upload-subtitle">–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                <input type="file" id="fileInput" accept=".docx">
            </div>

            <div class="template-preview" id="templatePreview" style="display: none;">
                <div class="template-preview-title">–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω:</div>
                <div class="template-placeholder" id="templateContent"></div>
            </div>

            <div class="placeholders-info">
                <div class="placeholders-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã:</div>
                <div class="placeholder-list">
                    <div class="placeholder-item"><code>{{–¢–ï–ú–ê}}</code> - –¢–µ–º–∞ —É—Ä–æ–∫–∞</div>
                    <div class="placeholder-item"><code>{{–ö–õ–ê–°–°}}</code> - –ö–ª–∞—Å—Å/–≥—Ä—É–ø–ø–∞</div>
                    <div class="placeholder-item"><code>{{–î–ê–¢–ê}}</code> - –î–∞—Ç–∞ —É—Ä–æ–∫–∞</div>
                    <div class="placeholder-item"><code>{{–ü–†–ï–î–ú–ï–¢}}</code> - –ü—Ä–µ–¥–º–µ—Ç</div>
                    <div class="placeholder-item"><code>{{–¶–ï–õ–¨}}</code> - –¶–µ–ª—å —É—Ä–æ–∫–∞</div>
                    <div class="placeholder-item"><code>{{–¢–ò–ü}}</code> - –¢–∏–ø —É—Ä–æ–∫–∞</div>
                    <div class="placeholder-item"><code>{{–û–ë–û–†–£–î–û–í–ê–ù–ò–ï}}</code> - –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</div>
                    <div class="placeholder-item"><code>{{–§–ò–û}}</code> - –§–ò–û —É—á–∏—Ç–µ–ª—è</div>
                </div>
            </div>
        </div>

        <!-- Right Panel - Form -->
        <div class="glass-card panel">
            <div class="panel-title">
                <span>‚úèÔ∏è</span> –î–∞–Ω–Ω—ã–µ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
            </div>
            <p class="panel-subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è, –∏ AI —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç</p>

            <div class="ai-processing" id="aiProcessing">
                <div class="ai-icon">ü§ñ</div>
                <div class="ai-title">AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ...</div>
                <div class="ai-subtitle">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ–∫—Å—Ç</div>
                <div class="ai-dots">
                    <div class="ai-dot"></div>
                    <div class="ai-dot"></div>
                    <div class="ai-dot"></div>
                </div>
            </div>

            <form id="generateForm">
                <div class="form-section">
                    <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                    <select class="form-select" id="subject">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                        <option value="–ê–ª–≥–µ–±—Ä–∞">–ê–ª–≥–µ–±—Ä–∞</option>
                        <option value="–ì–µ–æ–º–µ—Ç—Ä–∏—è">–ì–µ–æ–º–µ—Ç—Ä–∏—è</option>
                        <option value="–†—É—Å—Å–∫–∏–π —è–∑—ã–∫">–†—É—Å—Å–∫–∏–π —è–∑—ã–∫</option>
                        <option value="–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫</option>
                        <option value="–§–∏–∑–∏–∫–∞">–§–∏–∑–∏–∫–∞</option>
                        <option value="–•–∏–º–∏—è">–•–∏–º–∏—è</option>
                        <option value="–ë–∏–æ–ª–æ–≥–∏—è">–ë–∏–æ–ª–æ–≥–∏—è</option>
                        <option value="–ò—Å—Ç–æ—Ä–∏—è">–ò—Å—Ç–æ—Ä–∏—è</option>
                        <option value="–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ">–û–±—â–µ—Å—Ç–≤–æ–∑–Ω–∞–Ω–∏–µ</option>
                        <option value="–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞">–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-section">
                        <label class="form-label">–ö–ª–∞—Å—Å</label>
                        <input type="text" class="form-input" id="grade" placeholder="8–ë">
                    </div>
                    <div class="form-section">
                        <label class="form-label">–î–∞—Ç–∞ —É—Ä–æ–∫–∞</label>
                        <input type="date" class="form-input" id="date">
                    </div>
                </div>

                <div class="form-section">
                    <label class="form-label">–¢–µ–º–∞ —É—Ä–æ–∫–∞</label>
                    <input type="text" class="form-input" id="topic" placeholder="–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è">
                </div>

                <div class="form-section">
                    <label class="form-label">–¢–∏–ø —É—Ä–æ–∫–∞</label>
                    <select class="form-select" id="lessonType">
                        <option value="–ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞">–ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</option>
                        <option value="–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–∑—É—á–µ–Ω–Ω–æ–≥–æ">–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∏–∑—É—á–µ–Ω–Ω–æ–≥–æ</option>
                        <option value="–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∏ –æ–±–æ–±—â–µ–Ω–∏–µ">–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∏ –æ–±–æ–±—â–µ–Ω–∏–µ</option>
                        <option value="–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞">–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞</option>
                        <option value="–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π">–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π</option>
                    </select>
                </div>

                <div class="form-section">
                    <label class="form-label">–¶–µ–ª—å —É—Ä–æ–∫–∞</label>
                    <textarea class="form-textarea" id="goal" placeholder="–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —É–º–µ–Ω–∏—è —Ä–µ—à–∞—Ç—å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞–Ω—Ç..."></textarea>
                </div>

                <div class="form-section">
                    <label class="form-label">–§–ò–û —É—á–∏—Ç–µ–ª—è</label>
                    <input type="text" class="form-input" id="teacherName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                </div>

                <button type="submit" class="btn-generate" id="generateBtn" disabled>
                    <span>‚ú®</span>
                    –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                </button>
            </form>
        </div>
    </main>

    <!-- Success Modal -->
    <div class="success-modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">‚úÖ</div>
            <h2 class="success-title">–î–æ–∫—É–º–µ–Ω—Ç –≥–æ—Ç–æ–≤!</h2>
            <p class="success-subtitle">–ü–ª–∞–Ω —É—Ä–æ–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω</p>
            
            <div class="success-file">
                <span class="success-file-icon">üìÑ</span>
                <span class="success-file-name" id="generatedFileName">–ü–ª–∞–Ω_8–ë_–ê–ª–≥–µ–±—Ä–∞.docx</span>
            </div>
            
            <div class="success-buttons">
                <button class="btn-download" id="downloadBtn">–°–∫–∞—á–∞—Ç—å</button>
                <button class="btn-close" id="closeModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>
        // ========== API CONFIG ==========
        // –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ config.js
        const API_URL = SMARTGRADE_CONFIG.API_URL;
        // ========== STATE ==========
        let templateFile = null;
        let generatedBlob = null;

        // ========== SET DEFAULT DATE ==========
        document.getElementById('date').valueAsDate = new Date();

        // ========== FILE UPLOAD ==========
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');

        uploadZone.addEventListener('click', () => fileInput.click());

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.docx')) {
                handleFile(file);
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª .docx');
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        function handleFile(file) {
            templateFile = file;
            uploadZone.classList.add('has-file');
            uploadZone.querySelector('.upload-title').textContent = file.name;
            uploadZone.querySelector('.upload-subtitle').textContent = '–®–∞–±–ª–æ–Ω –∑–∞–≥—Ä—É–∂–µ–Ω';
            
            // Show template preview
            document.getElementById('templatePreview').style.display = 'block';
            document.getElementById('templateContent').innerHTML = `
                <div style="margin-bottom: 16px;"><strong>–ü–õ–ê–ù –£–†–û–ö–ê</strong></div>
                <div>–ü—Ä–µ–¥–º–µ—Ç: <span class="placeholder-tag">{{–ü–†–ï–î–ú–ï–¢}}</span></div>
                <div>–ö–ª–∞—Å—Å: <span class="placeholder-tag">{{–ö–õ–ê–°–°}}</span></div>
                <div>–¢–µ–º–∞: <span class="placeholder-tag">{{–¢–ï–ú–ê}}</span></div>
                <div>–¢–∏–ø —É—Ä–æ–∫–∞: <span class="placeholder-tag">{{–¢–ò–ü}}</span></div>
                <div>–î–∞—Ç–∞: <span class="placeholder-tag">{{–î–ê–¢–ê}}</span></div>
                <div style="margin-top: 16px;"><strong>–¶–ï–õ–¨ –£–†–û–ö–ê:</strong></div>
                <div><span class="placeholder-tag">{{–¶–ï–õ–¨}}</span></div>
                <div style="margin-top: 16px;"><strong>–§–ò–û —É—á–∏—Ç–µ–ª—è:</strong> <span class="placeholder-tag">{{–§–ò–û}}</span></div>
            `;
            
            checkFormValidity();
        }

        // ========== FORM VALIDATION ==========
        const formInputs = document.querySelectorAll('#generateForm input, #generateForm select, #generateForm textarea');
        
        formInputs.forEach(input => {
            input.addEventListener('input', checkFormValidity);
        });

        function checkFormValidity() {
            const subject = document.getElementById('subject').value;
            const grade = document.getElementById('grade').value;
            const topic = document.getElementById('topic').value;
            const goal = document.getElementById('goal').value;
            const teacherName = document.getElementById('teacherName').value;
            
            const isValid = subject && grade && topic && goal && teacherName;
            document.getElementById('generateBtn').disabled = !isValid;
        }

        // ========== GENERATE DOCUMENT ==========
        const generateForm = document.getElementById('generateForm');
        const aiProcessing = document.getElementById('aiProcessing');
        const generateBtn = document.getElementById('generateBtn');

        generateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Show AI processing
            aiProcessing.classList.add('active');
            generateBtn.disabled = true;
            
            // Simulate AI processing delay
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // Generate document
            try {
                await generateDocument();
                
                // Show success modal
                aiProcessing.classList.remove('active');
                document.getElementById('successModal').classList.add('active');
            } catch (error) {
                console.error('Error generating document:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
                aiProcessing.classList.remove('active');
                generateBtn.disabled = false;
            }
        });

        async function generateDocument() {
            const subject = document.getElementById('subject').value;
            const grade = document.getElementById('grade').value;
            const date = document.getElementById('date').value;
            const topic = document.getElementById('topic').value;
            const lessonType = document.getElementById('lessonType').value;
            const goal = document.getElementById('goal').value;
            const teacherName = document.getElementById('teacherName').value;

            // Format date
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            let generatedText = "";
            
            // Check if API key is valid
            const apiKey = SMARTGRADE_CONFIG.API_KEY;
            if (!apiKey || apiKey === 'YOUR_API_KEY_HERE' || apiKey === '') {
                // Demo mode
                generatedText = `–û–†–ì–ê–ù–ò–ó–ê–¶–ò–û–ù–ù–´–ô –ú–û–ú–ï–ù–¢
- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

–ê–ö–¢–£–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ù–ê–ù–ò–ô
- –û–ø—Ä–æ—Å –ø–æ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º—É
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–ó

–ò–ó–£–ß–ï–ù–ò–ï –ù–û–í–û–ì–û –ú–ê–¢–ï–†–ò–ê–õ–ê
–¢–µ–º–∞: ${topic}

1. –ú–æ—Ç–∏–≤–∞—Ü–∏—è
2. –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª
3. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

–ó–ê–ö–†–ï–ü–õ–ï–ù–ò–ï
- –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –í–∑–∞–∏–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞

–î–û–ú–ê–®–ù–ï–ï –ó–ê–î–ê–ù–ò–ï`;
            } else {
                const prompt = `–¢—ã –æ–ø—ã—Ç–Ω—ã–π –º–µ—Ç–æ–¥–∏—Å—Ç. –ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω-–∫–æ–Ω—Å–ø–µ–∫—Ç —É—Ä–æ–∫–∞.
                –ü—Ä–µ–¥–º–µ—Ç: ${subject}, –ö–ª–∞—Å—Å: ${grade}, –¢–µ–º–∞: ${topic}, –¢–∏–ø: ${lessonType}
                –¶–µ–ª—å: ${goal}

                –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
                1. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç
                2. –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–Ω–∞–Ω–∏–π
                3. –ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞
                4. –ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ
                5. –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ

                –ü–∏—à–∏ –ø—Ä–æ—Å—Ç—ã–º —Ç–µ–∫—Å—Ç–æ–º –±–µ–∑ Markdown.`;

                try {
                    const response = await fetch(SMARTGRADE_CONFIG.API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });
                    const data = await response.json();
                    if (data.candidates && data.candidates[0]) {
                        generatedText = data.candidates[0].content.parts[0].text;
                    } else {
                        generatedText = "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á.";
                    }
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ AI:", error);
                    generatedText = "–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.";
                }
            }

            // If we have a template file, use docxtemplater
            if (templateFile) {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫
                    if (typeof PizZip === 'undefined' || typeof window.docxtemplater === 'undefined') {
                        throw new Error('–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                    }
                    
                    const arrayBuffer = await templateFile.arrayBuffer();
                    const zip = new PizZip(arrayBuffer);
                    const doc = new window.docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true
                    });

                    doc.render({
                        –ü–†–ï–î–ú–ï–¢: subject,
                        –ö–õ–ê–°–°: grade,
                        –î–ê–¢–ê: formattedDate,
                        –¢–ï–ú–ê: topic,
                        –¢–ò–ü: lessonType,
                        –¶–ï–õ–¨: goal,
                        –§–ò–û: teacherName,
                        –û–ë–û–†–£–î–û–í–ê–ù–ò–ï: '–î–æ—Å–∫–∞, –ø—Ä–æ–µ–∫—Ç–æ—Ä, –Ω–æ—É—Ç–±—É–∫'
                    });

                    const out = doc.getZip().generate({
                        type: 'blob',
                        mimeType: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
                    });

                    generatedBlob = out;
                    const safeTopic = topic.replace(/[^–∞-—è–ê-–Ø—ë–Åa-zA-Z0-9]/g, '_');
                    document.getElementById('generatedFileName').textContent = `–ü–ª–∞–Ω_${grade}_${safeTopic}.docx`;
                    return;
                } catch (error) {
                    console.log('Template error, using fallback:', error.message);
                }
            }

            // Create a simple text document as fallback
            generatedBlob = createFallbackDocument(subject, grade, formattedDate, topic, lessonType, goal, teacherName);
            
            // Update filename in modal
            const safeTopic = topic.replace(/[^–∞-—è–ê-–Ø—ë–Åa-zA-Z0-9]/g, '_');
            document.getElementById('generatedFileName').textContent = `–ü–ª–∞–Ω_${grade}_${safeTopic}.txt`;
        }

        function createFallbackDocument(subject, grade, date, topic, type, goal, teacher) {
            // Create a simple RTF document as fallback
            const content = `–ü–õ–ê–ù –£–†–û–ö–ê\n\n–ü—Ä–µ–¥–º–µ—Ç: ${subject}\n–ö–ª–∞—Å—Å: ${grade}\n–î–∞—Ç–∞: ${date}\n–¢–µ–º–∞: ${topic}\n–¢–∏–ø —É—Ä–æ–∫–∞: ${type}\n\n–¶–ï–õ–¨ –£–†–û–ö–ê:\n${goal}\n\n–§–ò–û —É—á–∏—Ç–µ–ª—è: ${teacher}\n\n–•–û–î –£–†–û–ö–ê:\n\n1. –û–†–ì–ê–ù–ò–ó–ê–¶–ò–û–ù–ù–´–ô –ú–û–ú–ï–ù–¢ (2-3 –º–∏–Ω)\n- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —É—Ä–æ–∫—É\n\n2. –ê–ö–¢–£–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ù–ê–ù–ò–ô (5-7 –º–∏–Ω)\n- –§—Ä–æ–Ω—Ç–∞–ª—å–Ω—ã–π –æ–ø—Ä–æ—Å\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è\n\n3. –ò–ó–£–ß–ï–ù–ò–ï –ù–û–í–û–ì–û –ú–ê–¢–ï–†–ò–ê–õ–ê (15-20 –º–∏–Ω)\n- –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–µ–º—ã\n- –ü—Ä–∏–º–µ—Ä—ã\n- –†–∞–±–æ—Ç–∞ —É –¥–æ—Å–∫–∏\n\n4. –ó–ê–ö–†–ï–ü–õ–ï–ù–ò–ï (10-15 –º–∏–Ω)\n- –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞\n- –í–∑–∞–∏–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞\n\n5. –ü–û–î–í–ï–î–ï–ù–ò–ï –ò–¢–û–ì–û–í (3-5 –º–∏–Ω)\n- –†–µ—Ñ–ª–µ–∫—Å–∏—è\n- –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ`;

            // Create blob with simple text (in real app, would use proper docx library)
            return new Blob([content], { type: 'text/plain' });
        }

        // ========== DOWNLOAD ==========
        const downloadBtn = document.getElementById('downloadBtn');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const successModal = document.getElementById('successModal');

        downloadBtn.addEventListener('click', () => {
            if (generatedBlob) {
                const filename = document.getElementById('generatedFileName').textContent;
                const url = URL.createObjectURL(generatedBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });

        closeModalBtn.addEventListener('click', () => {
            successModal.classList.remove('active');
            generateBtn.disabled = false;
        });

        successModal.addEventListener('click', (e) => {
            if (e.target === successModal) {
                successModal.classList.remove('active');
                generateBtn.disabled = false;
            }
        });
    </script>